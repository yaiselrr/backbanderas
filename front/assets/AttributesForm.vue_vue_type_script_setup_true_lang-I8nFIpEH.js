var e=Object.defineProperty,a=(a,t,l)=>((a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l)(a,"symbol"!=typeof t?t+"":t,l);import{C as t,n as l,z as s,aj as i,d as n,h as r,ak as o,al as d,r as c,i as u,w as p,a as f,E as m,am as v,x as y,y as g,c as x,A as b,U as h,ae as k,q as _,H as w,an as C,ao as j,ap as S,N as F,G as V,ad as z,aq as I,p as U,o as A,X as L,j as q,Y as E,k as K,S as R,v as O,O as N,Z as T,M,T as B,L as D}from"./index-D0wN_fuZ.js";import{_ as P}from"./RForm.vue_vue_type_script_setup_true_lang-HqTuq9xx.js";import{R as J,C as G}from"./RestBase-6hwWqa7t.js";import{r as H,R as W,b as X}from"./index-CFoXpmaN.js";import{d as Y,l as Z}from"./index-brT4NzTB.js";import{_ as $}from"./RButton.vue_vue_type_style_index_0_lang-DWca47Ax.js";import{u as Q}from"./usePopupContainer-BObfUw_y.js";import{_ as ee}from"./index-BstQ-YzR.js";const ae={create:{name:{required:H},type:{required:H},strcuture:{}},update:{name:{required:H},type:{required:H},strcuture:{}}},te=await J("attributes","masters/attributes"),le=class extends te{constructor(e=null){super(),a(this,"id"),a(this,"name"),a(this,"type"),a(this,"strcuture"),a(this,"created_at"),a(this,"updated_at"),null!=e&&(this.id=e.id||void 0,this.name=e.name||null,this.type=e.type||null,this.strcuture=e.strcuture||null,this.created_at=e.created_at?Y(e.created_at):null,this.updated_at=e.updated_at?Y(e.updated_at):null)}set_attributes(e=null){null!=e&&(this.id=e.id,this.name=e.name,this.type=e.type,this.strcuture=e.strcuture,this.created_at=Y(e.created_at),this.updated_at=Y(e.updated_at))}get_id(){return this.id}class_name(){return"Attributes"}};a(le,"validations",ae),a(le,"feedbacks",{create:{id:{isUnique:"This id has been taken"}},update:{id:{isUnique:"This id has been taken"}}}),a(le,"columns",[{title:"Nombre",dataIndex:"name",align:"center",key:"name",sorter:(e,a)=>+(e.name>a.name)-+(e.name<a.name)},{title:"Tipo",dataIndex:"type",align:"center",key:"type",sorter:(e,a)=>+(e.type>a.type)-+(e.type<a.type)},{title:"Estructura",dataIndex:"strcuture",align:"center",key:"strcuture",sorter:(e,a)=>+(e.strcuture>a.strcuture)-+(e.strcuture<a.strcuture)},{title:"Acciones",key:"_action",fixed:"right",width:"5%",scopedSlots:{customRender:"_action"}}]),a(le,"visible_columns",le.show_columns(["name","type","_action"],!0));let se=le;const ie=[{key:"string",text:"String"},{key:"number",text:"Number"},{key:"boolean",text:"Boolean"},{key:"object",text:"Object"}],ne={},re={class:"key-value-editor flex flex-col pl-5"},oe=[i('<div class="flex flex-row"><div style="margin-top:-30px;" class="vert-dots"><p></p></div></div><div class="flex flex-row"><div class="hor-dots"><p></p></div><div class="transform -translate-y-1"><span title="Agregar campo"><div class="i-heroicons:plus-circle insert-field-icon"></div></span></div></div>',2)];const de=t(ne,[["render",function(e,a){return l(),s("div",re,oe)}]]),ce={class:"flex flex-row"},ue=[y("p",null,null,-1)],pe=[y("p",null,null,-1)],fe={class:"ml-0 flex flow-row items-center space-x-3"},me={class:"input-container !ml-0"},ve=y("span",null,"=",-1),ye={class:"input-container"},ge={key:0,title:"Eliminar este campo"},xe={class:"flex flex-row"},be=[y("p",null,null,-1)],he={key:0,class:"flex flex-col pb-4"},ke={key:0,class:"flex flex-row"},_e=[y("p",null,null,-1)],we={class:"transform -translate-y-1"},Ce=[y("div",{"w:group-hover":"text-dark-900","w:dark":"group-hover:text-slate-200",class:"i-heroicons:plus-circle-solid text-gray-500 remove-field-icon"},null,-1),y("span",{class:"ml-2 mb-1 text-gray-500","w:dark":"group-hover:text-slate-400","w:group-hover":"text-dark-900"}," Agregar campo ",-1)],je=n({__name:"KeyValueEditorItem",props:{isLast:r.bool.def(!1),isFirst:r.bool.def(!1),field:r.object,level:r.number.def(1),index:r.number.isRequired,parentIndex:r.number.def(1)},emits:["addField","removeField"],setup(e,{emit:a}){const t=e,i=a,n=o(t,"field"),[r,C]=d(),j=c(t.level),S=u("focusedLevel"),F=u("maxDeep"),V=u("editable"),z=u("parentIndex"),I=u("changeLevelFocused"),U=u("validateKey"),A=u("addInvalid");p(U,(async()=>{await M.value.validate()||null==A||A()}));const L=f((()=>j.value==(null==S?void 0:S.value)&&(null==z?void 0:z.value)==t.parentIndex)),q=f((()=>j.value<m(F)));function E(){i("addField")}function K(){i("removeField",t.index)}function R(e){n.value.fields.splice(e,1)}function O(){n.value.fields||(n.value.fields=[]),n.value.fields.push({field:"",type:"string"})}v(r,(()=>null==I?void 0:I(j.value,t.parentIndex))),v(Z(r),(()=>{setTimeout((()=>{r.value||null==I||I(null)}),200)}));const N={required:H},T={required:"Obligatorio"},M=c(),{getPopupContainerFn:B,container:D}=Q("click");return(a,t)=>{const i=w("KeyValueEditorItem",!0);return l(),s("div",{ref_key:"container",ref:D,class:"key-value-editor flex flex-col pl-5"},[y("div",ce,[y("div",{class:g(["vert-dots",{first:e.isFirst,active:m(L)}])},ue,2),y("div",{class:g([{"pb-5":e.isLast&&1===m(j)},"flex flow-row items-center"])},[y("div",{class:g([{active:m(L)},"hor-dots"])},pe,2),y("div",fe,[y("div",me,[x(m(W),{ref_key:"input",ref:M,modelValue:m(n).field,"onUpdate:modelValue":t[0]||(t[0]=e=>m(n).field=e),feedbacks:T,validations:N,disabled:!m(V),label:"Campo",onChangeFocus:m(C)},null,8,["modelValue","disabled","onChangeFocus"])]),ve,y("div",ye,[x(m(X),{modelValue:m(n).type,"onUpdate:modelValue":t[1]||(t[1]=e=>m(n).type=e),getPopupContainer:m(B),"id-key":"key",items:m(ie),disabled:!m(V),label:"Tipo"},null,8,["modelValue","getPopupContainer","items","disabled"])]),m(V)?(l(),s("span",ge,[y("div",{class:"i-heroicons:minus-circle-solid remove-field-icon",onClick:K})])):b("",!0)])],2)]),y("div",xe,[y("div",{class:g([{active:m(L)},"vert-dots"])},be,2),m(n).fields&&m(n).fields.length?(l(),s("div",he,[(l(!0),s(h,null,k(m(n).fields,((a,t)=>(l(),_(i,{key:t,field:m(n).fields[t],"onUpdate:field":e=>m(n).fields[t]=e,isFirst:0===t,isLast:t===m(n).fields.length-1,level:m(j)+1,class:"pl-15",index:t,parentIndex:e.index,onRemoveField:R,onAddField:O},null,8,["field","onUpdate:field","isFirst","isLast","level","index","parentIndex"])))),128))])):"object"===m(n).type&&m(V)?(l(),_(de,{key:1,class:"pl-15",onClick:O})):b("",!0)]),e.isLast&&m(V)&&m(q)?(l(),s("div",ke,[y("div",{class:g([{active:m(L)},"hor-dots"])},_e,2),y("div",we,[m(L)?(l(),s("span",{key:1,class:"cursor-pointer group flex items-center",onClick:E},Ce)):(l(),s("span",{key:0,title:"Agregar campo",onClick:E},[y("div",{class:g(["i-heroicons:plus-circle insert-field-icon",{active:m(L)}])},null,2)]))])])):b("",!0)],512)}}}),Se={class:"w-fit-content h-fit-content rounded-full flex-center bg-opacity-10 bg-rose-500"},Fe=n({__name:"DangerCircle",props:{iconSize:{type:String,default:"1.7em"}},setup:e=>(a,t)=>(l(),s("div",Se,[y("div",{style:C({"font-size":e.iconSize}),class:"i-heroicons:exclamation-circle dark:text-rose-600 dark:text-opacity-80 text-rose-500"},null,4)]))}),Ve={class:"w-fit-content h-fit-content bg-yellow-500 rounded-full flex-center bg-opacity-10"},ze=n({__name:"WarningCircle",props:{iconSize:{type:String,default:"1.7em"}},setup:e=>(a,t)=>(l(),s("div",Ve,[y("div",{style:C({"font-size":e.iconSize}),class:"i-heroicons:exclamation-circle dark:text-yellow-400 dark:text-opacity-80 text-yellow-500"},null,4)]))}),Ie={class:"w-fit-content h-fit-content rounded-full flex-center bg-opacity-10 bg-green-500"},Ue=n({__name:"SuccessCircle",props:{iconSize:{type:String,default:"1.7em"}},setup:e=>(a,t)=>(l(),s("div",Ie,[y("div",{style:C({"font-size":e.iconSize}),class:"i-heroicons:check-circle dark:text-green-400 dark:text-opacity-80 text-green-400"},null,4)]))}),Ae={class:"w-fit-content h-fit-content rounded-full flex-center bg-opacity-10 bg-blue-500"},Le=n({__name:"InfoCircle",props:{iconSize:{type:String,default:"1.7em"}},setup:e=>(a,t)=>(l(),s("div",Ae,[y("div",{style:C({"font-size":e.iconSize}),class:"i-heroicons:information-circle dark:text-blue-400 dark:text-opacity-80 text-blue-400"},null,4)]))});function qe(e,a="success",t={}){const{duration:l=4,onClose:s,key:i}=t,n=null!=i?i:S(),r="flex-center h-5 min-w-5 mr-2 mt-0.2 w-5 !bg-transparent";return j[a]({content:e,duration:l,onClose:s,icon:(()=>{switch(a){case"error":return x(Fe,{class:r,iconSize:"1.3em"},null,8,["class"]);case"success":return x(Ue,{class:r,iconSize:"1.3em"},null,8,["class"]);case"info":return x(Le,{class:r,iconSize:"1.3em"},null,8,["class"]);case"warning":return x(ze,{class:r,iconSize:"1.3em"},null,8,["class"])}})(),key:n}),n}j.config({top:"60px",duration:2,maxCount:3});const Ee={success:function(e,a){return qe(e,"success",a)},error:function(e,a){return qe(e,"error",a)},warning:function(e,a){return qe(e,"warning",a)},info:function(e,a){return qe(e,"info",a)},warn:function(e,a){return qe(e,"warning",a)},loading:function(e,a){return qe(e,"loading",a)},destroy:j.destroy},Ke={class:"relative json-tree"},Re={for:"",class:"font-bold"},Oe={class:"mt-10"},Ne=n({__name:"JsonTree",props:{fields:r.array.def([]),label:r.string,editable:r.bool.def(!0),maxDeep:r.number.def(50)},setup(e,{expose:a}){const t=e,{editable:i,maxDeep:n}=F(t),r=o(t,"fields"),u=c(),p=c();function f(){r.value.push({field:"",type:"string"})}function v(e){r.value.splice(e,1)}const[g,x]=d(),b=c(0);return U("editable",i),U("maxDeep",n),U("addInvalid",(function(){b.value++})),U("validateKey",g),U("focusedLevel",u),U("parentIndex",p),U("changeLevelFocused",(function(e,a){u.value=e,p.value=a})),a({validate:async function(){return r.value.length?(b.value=0,x(!0),z((()=>x(!1))),await I(200),0==b.value):(Ee.warn("Debe agregar al menos un campo"),!1)}}),(a,t)=>(l(),s("div",Ke,[y("label",Re,V(e.label),1),y("div",Oe,[m(r).length?(l(!0),s(h,{key:0},k(m(r),((e,a)=>(l(),_(je,{key:a,field:m(r)[a],"onUpdate:field":e=>m(r)[a]=e,isFirst:0===a,isLast:a===m(r).length-1,index:a,onAddField:f,onRemoveField:v},null,8,["field","onUpdate:field","isFirst","isLast","index"])))),128)):(l(),_(de,{key:1,onClick:f}))])]))}}),Te={ref:"container",class:"overflow-hidden mt-5"},Me=n({__name:"RAttribute",props:{data:void 0|r.arrayOf(r.object).isRequired},setup(e){const a=e,t=c([]),i=c(["0-0","0-1"]),n=c([]);let r=[];return A((()=>{null!=a.data&&(a.data,Object.values(a.data).forEach(((e,a)=>{let l={title:"",key:"",children:[]};l.title=e.field,l.key="0-".concat(a),"object"===e.type&&Object.values(e.fields).forEach(((e,a)=>{l.children.push({title:e.field,key:"0-".concat(a,"-").concat(a),isLeaf:!0})})),t.value.push(l)})),i.value=a.data.map(((e,a)=>"0-".concat(a))),r=t.value)})),(e,a)=>{const t=ee;return l(),s("div",Te,[x(t,{expandedKeys:i.value,"onUpdate:expandedKeys":a[0]||(a[0]=e=>i.value=e),selectedKeys:n.value,"onUpdate:selectedKeys":a[1]||(a[1]=e=>n.value=e),multiple:"","tree-data":m(r)},null,8,["expandedKeys","selectedKeys","tree-data"])],512)}}}),Be={class:"r-container-form"},De={class:"mt-10 sm:mt-0"},Pe={class:"shadow overflow-hidden sm:rounded-md"},Je={class:"px-4 py-5 bg-white dark:bg-slate-800 sm:p-6"},Ge={class:"grid grid-cols-4 gap-4"},He={class:"grid-input"},We={class:"grid-input"},Xe={class:"px-4 py-5 bg-white dark:bg-slate-800 sm:p-6"},Ye={class:"grid grid-cols-4 gap-4"},Ze={class:"col-span-2"},$e={class:"px-4 py-3 bg-gray-50 dark:bg-slate-700 dark:bg-opacity-70 text-right sm:px-6"},Qe={class:"r-footer-form"},ea={class:"flex"},aa={key:0,class:"flex-none items-center"},ta=[y("label",{for:"andNew",class:"font-bold text-gray-700 dark:text-slate-200 !cursor-pointer"},[D("Insertar y nuevo "),y("span",{id:"andNew-description",class:"ml-1 text-muted"},"Se insertará un elemento y reiniciará el formulario")],-1)],la={class:"r-footer-button-form"},sa=n({__name:"AttributesForm",props:L({modal:r.bool.def(!1),action:r.string.def("create"),loading_text:r.string.def(""),showLoading:r.bool.def(!0)},{modelValue:{},modelModifiers:{}}),emits:L(["closeModal","reload"],["update:modelValue"]),setup(e,{emit:a}){const t=q(),i=e,n=a,r="create"==i.action?"Crear":"Actualizar",o=E(e,"modelValue"),d=K(new se(o.value)),u=c(),p=c(!1);let f=c(!1),v=c(!1),g=c([]),k=c([]);const{loading:w,toggleEnabled:C,onResult:j,enabled:S,onError:F}=se.useStaticSave(d,{defaultEnabled:!1}),z=c(!1),I=()=>{i.modal?n("closeModal"):t.push({name:"blocks_list"})};async function U(){var e;"update"===i.action&&(d.strcuture=JSON.stringify(k.value)),"create"===i.action&&(d.strcuture=JSON.stringify(g.value));await(null==(e=u.value)?void 0:e.validate())&&C()}F((e=>{R("error","Error en accion","Error en accion del elemento")})),j((e=>{var a;R("success","Accion  "+r,"Accion ejecutada correctamente"),p.value?(null==(a=u.value)||a.clear(),S.value=!1,Object.assign(d,new se(o.value)),i.modal&&n("reload")):i.modal?n("closeModal",!0):t.push({name:"blocks_list"})}));const L=()=>{f.value=!0},J=()=>{v.value=!0},H=()=>{f.value=!1},X=()=>{v.value=!1};return A((()=>{"update"===i.action&&(k.value=JSON.parse(d.strcuture),v.value=!0)})),(a,t)=>{const n=G;return l(),s(h,null,[e.showLoading?(l(),_(T,{key:0,"h-full":!0,class:"",loading:m(z),description:i.loading_text},{default:O((()=>[N(a.$slots,"loading_icon")])),_:3},8,["loading","description"])):b("",!0),y("div",Be,[y("div",De,[y("div",Pe,[x(P,{ref_key:"attributesForm",ref:u,state:m(d),validations:m(se).validations[e.action],feedbacks:m(se).feedbacks[e.action],loading:!0},{default:O((()=>[y("div",Je,[y("div",Ge,[y("div",He,[x(m(W),{type:"text",requiredMark:!0,modelValue:m(d).name,"onUpdate:modelValue":t[0]||(t[0]=e=>m(d).name=e),path:"name",label:"Nombre",onKeyup:M(U,["enter"])},null,8,["modelValue"])]),y("div",We,[x(m(W),{type:"text",requiredMark:!0,modelValue:m(d).type,"onUpdate:modelValue":t[1]||(t[1]=e=>m(d).type=e),path:"type",label:"Tipo",onKeyup:M(U,["enter"])},null,8,["modelValue"])])])]),y("div",Xe,[y("div",Ye,[y("div",Ze,["create"===e.action?(l(),_(Ne,{key:0,ref:"jsonTree",fields:m(g),"onUpdate:fields":t[2]||(t[2]=e=>B(g)?g.value=e:g=e),label:"Create json template",class:"w-full"},null,8,["fields"])):b("",!0),"update"===e.action?(l(),_(Ne,{key:1,ref:"jsonTree",fields:m(k),"onUpdate:fields":t[3]||(t[3]=e=>B(k)?k.value=e:k=e),label:"Create json template",class:"w-full",onClick:X},null,8,["fields"])):b("",!0)]),m(f)&&"create"===e.action?(l(),_(Me,{key:0,data:m(g)},null,8,["data"])):b("",!0),m(v)&&m(k).length>0&&"update"===e.action?(l(),_(Me,{key:1,data:m(k)},null,8,["data"])):b("",!0),m(g).length>0&&!m(f)?(l(),_($,{key:2,class:"ml-5",shadow:"",color:"primary",loading:m(w),onClick:L},{default:O((()=>[D(" Vista previa de atributos ")])),_:1},8,["loading"])):b("",!0),m(k).length>0&&!m(v)?(l(),_($,{key:3,class:"ml-5",shadow:"",color:"primary",loading:m(w),onClick:J},{default:O((()=>[D(" Vista previa de atributos ")])),_:1},8,["loading"])):b("",!0),m(f)?(l(),_($,{key:4,class:"ml-5",shadow:"",color:"primary",loading:m(w),onClick:H},{default:O((()=>[D(" Borrar mapa de atributos ")])),_:1},8,["loading"])):b("",!0),m(v)?(l(),_($,{key:5,class:"ml-5",shadow:"",color:"primary",loading:m(w),onClick:X},{default:O((()=>[D(" Borrar mapa de atributos ")])),_:1},8,["loading"])):b("",!0)])]),y("div",$e,[y("div",Qe,[y("div",ea,["create"===e.action?(l(),s("div",aa,[x(n,{checked:m(p),"onUpdate:checked":t[4]||(t[4]=e=>B(p)?p.value=e:null),"aria-describedby":"offers-description",id:"andNew"},null,8,["checked"])])):b("",!0),"create"===e.action?(l(),s("div",{key:1,onClick:t[5]||(t[5]=e=>m(p).value!=m(p).value),class:"flex text-sm absolute mx-[2rem] my-[4px]"},ta)):b("",!0)]),y("div",la,[x($,{class:"ml-5",shadow:"",color:"primary",loading:m(w),onClick:U},{default:O((()=>[D(V(m(r))+" Atributos ",1)])),_:1},8,["loading"]),x($,{class:"ml-5",shadow:"",color:"primary",onClick:I},{default:O((()=>[D(" Cancelar ")])),_:1})])])])])),_:1},8,["state","validations","feedbacks"])])])])],64)}}});export{se as A,sa as _};
